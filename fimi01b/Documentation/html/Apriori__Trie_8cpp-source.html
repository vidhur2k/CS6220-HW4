<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>APRIORI algorithm: Apriori_Trie.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Apriori_Trie.cpp</h1><a href="Apriori__Trie_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/***************************************************************************</span>
00002 <span class="comment">                          Apriori_Trie.cpp  -  description</span>
00003 <span class="comment">                             -------------------</span>
00004 <span class="comment">    begin                : cs dec 26 2002</span>
00005 <span class="comment">    copyright            : (C) 2002 by Ferenc Bodon</span>
00006 <span class="comment">    email                : bodon@mit.bme.hu</span>
00007 <span class="comment"> ***************************************************************************/</span>
00008 
00009 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00010 <span class="preprocessor">#include &lt;iostream&gt;</span>
00011 <span class="preprocessor">#include &lt;iterator&gt;</span>
00012 <span class="preprocessor">#include &lt;numeric&gt;</span>
00013 <span class="preprocessor">#include "<a class="code" href="Apriori__Trie_8hpp.html">Apriori_Trie.hpp</a>"</span>
00014 
<a name="l00019"></a><a class="code" href="classApriori__Trie.html#a0">00019</a> <a class="code" href="classApriori__Trie.html#a0">Apriori_Trie::Apriori_Trie</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> counter_of_emptyset ):
00020    main_trie(counter_of_emptyset)
00021 {
00022    <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.push_back(1);
00023 }
00024 
<a name="l00029"></a><a class="code" href="classApriori__Trie.html#a1">00029</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#a1">Apriori_Trie::insert_frequent_items</a>(
00030    <span class="keyword">const</span> vector&lt;unsigned long&gt;&amp; counters )
00031 {
00032    <span class="keywordflow">for</span>(vector&lt;unsigned long&gt;::size_type item_index = 0; 
00033        item_index &lt; counters.size(); item_index++)
00034       <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#d0">add_empty_state</a>( item_index, counters[item_index] );
00035    <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.push_back(counters.size());
00036 }
00037 
<a name="l00042"></a><a class="code" href="classApriori__Trie.html#a2">00042</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#a2">Apriori_Trie::candidate_generation</a>( <span class="keyword">const</span> <a class="code" href="common_8hpp.html#a0">itemtype</a>&amp; frequent_size,
00043                                          <a class="code" href="classInput__Output__Manager.html">Input_Output_Manager</a>&amp; 
00044                                          input_output_manager )
00045 {
00046    <span class="keywordflow">if</span>( frequent_size == 1 ) <a class="code" href="classApriori__Trie.html#b1">candidate_generation_two</a>();
00047    <span class="keywordflow">else</span>
00048    {
00049       set&lt;itemtype&gt; maybe_candidate;
00050       <a class="code" href="classApriori__Trie.html#b2">candidate_generation_assist</a>( &amp;<a class="code" href="classApriori__Trie.html#p0">main_trie</a>, frequent_size-1, 
00051                                    maybe_candidate, input_output_manager );
00052    }
00053 }
00054 
<a name="l00062"></a><a class="code" href="classApriori__Trie.html#a3">00062</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#a3">Apriori_Trie::find_candidate</a>( <span class="keyword">const</span> vector&lt;itemtype&gt;&amp; basket, 
00063                                    <span class="keyword">const</span> <a class="code" href="common_8hpp.html#a0">itemtype</a> candidate_size, 
00064                                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> counter_incr)
00065 {
00066    <span class="keywordflow">if</span>( candidate_size != 2 ) 
00067       <span class="keywordflow">if</span> ( candidate_size&lt;basket.size()+1 )
00068          <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#a2">find_candidate</a>( basket.end()-candidate_size+1, 
00069                                    candidate_size, 
00070                                    basket.begin(), counter_incr );
00071       <span class="keywordflow">else</span>;
00072    <span class="keywordflow">else</span> <a class="code" href="classApriori__Trie.html#b3">find_candidate_two</a>( basket, counter_incr );    
00073 }
00074 
<a name="l00079"></a><a class="code" href="classApriori__Trie.html#a4">00079</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#a4">Apriori_Trie::delete_infrequent</a>( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> min_occurrence, 
00080                                       <span class="keyword">const</span> <a class="code" href="common_8hpp.html#a0">itemtype</a> candidate_size )
00081 {
00082    <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.push_back(0);
00083    <span class="keywordflow">if</span>( candidate_size != 2 ) 
00084       <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#a3">delete_infrequent</a>( min_occurrence, 
00085                                    candidate_size - 1,
00086                                    <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>[candidate_size]);
00087    <span class="keywordflow">else</span> <a class="code" href="classApriori__Trie.html#b4">delete_infrequent_two</a>( min_occurrence );
00088    <span class="keywordflow">if</span>( !<a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.back() ) 
00089       <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.pop_back();
00090 }
00091 
<a name="l00092"></a><a class="code" href="classApriori__Trie.html#a5">00092</a> <span class="keywordtype">bool</span> <a class="code" href="classApriori__Trie.html#a5">Apriori_Trie::is_there_any_candidate</a>()<span class="keyword"> const</span>
00093 <span class="keyword"></span>{
00094    <span class="keywordflow">return</span> !<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.empty();
00095 }
00096 
<a name="l00097"></a><a class="code" href="classApriori__Trie.html#a6">00097</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#a6">Apriori_Trie::statistics</a>()<span class="keyword"> const</span>
00098 <span class="keyword"></span>{
00099    cout &lt;&lt; accumulate(<a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.begin(), 
00100                       <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.end(), 0) &lt;&lt; <span class="charliteral">'\n'</span>;
00101    copy(<a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.begin(), 
00102         <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>.end(), 
00103         ostream_iterator&lt;unsigned long&gt;(cout, <span class="stringliteral">"\n"</span>));
00104 }
00105 
<a name="l00106"></a><a class="code" href="classApriori__Trie.html#a7">00106</a> <a class="code" href="classApriori__Trie.html#a7">Apriori_Trie::~Apriori_Trie</a>()
00107 {
00108 }
00109 
<a name="l00114"></a><a class="code" href="classApriori__Trie.html#b0">00114</a> <span class="keywordtype">bool</span> <a class="code" href="classApriori__Trie.html#b0">Apriori_Trie::is_all_subset_frequent</a>( 
00115    <span class="keyword">const</span> set&lt;itemtype&gt;&amp; maybe_candidate )<span class="keyword"> const</span>
00116 <span class="keyword"></span>{
00117    <span class="keywordflow">if</span>( maybe_candidate.size() &lt; 3) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// because of the </span>
00118                                                 <span class="comment">// candidate generation method!</span>
00119    <span class="keywordflow">else</span>
00120    {
00121       set&lt;itemtype&gt;                 temp_itemset(maybe_candidate);
00122       set&lt;itemtype&gt;::const_iterator item_it = --(--maybe_candidate.end());
00123       <span class="keywordflow">do</span>
00124       {
00125          item_it--;
00126          temp_itemset.erase( *item_it );
00127          <span class="keywordflow">if</span>( !<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#a1">is_included</a>( temp_itemset, temp_itemset.begin() ) ) 
00128             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00129          temp_itemset.insert( *item_it );
00130       }
00131       <span class="keywordflow">while</span> ( item_it != maybe_candidate.begin() );
00132       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00133    }
00134 }
00135 
<a name="l00136"></a><a class="code" href="classApriori__Trie.html#b1">00136</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#b1">Apriori_Trie::candidate_generation_two</a>()
00137 {
00138    <span class="keywordflow">if</span>( !<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.empty() )
00139    {
00140       <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>.reserve(<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1);
00141       <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>.resize(<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1);
00142       <span class="keywordflow">for</span>( vector&lt;Edge&gt;::size_type stateIndex = 0; 
00143            stateIndex &lt; <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1; stateIndex++ )
00144       {
00145          <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex].reserve(
00146             <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1-stateIndex );
00147          <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex].resize(
00148             <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1-stateIndex, 0);
00149       }
00150    }
00151 }
00152 
<a name="l00153"></a><a class="code" href="classApriori__Trie.html#b2">00153</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#b2">Apriori_Trie::candidate_generation_assist</a>( 
00154    <a class="code" href="classTrie.html">Trie</a>* trie, 
00155    <span class="keyword">const</span> <a class="code" href="common_8hpp.html#a0">itemtype</a> distance_from_generator,
00156    set&lt;itemtype&gt;&amp; maybe_candidate,
00157    <a class="code" href="classInput__Output__Manager.html">Input_Output_Manager</a>&amp; input_output_manager)
00158 {
00159    vector&lt;Edge&gt;::iterator itEdge = trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.begin();
00160    <span class="keywordflow">if</span>( distance_from_generator )
00161    {
00162       <span class="keywordflow">while</span>( itEdge != trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.end() )
00163       {
00164          maybe_candidate.insert((*itEdge).label);
00165          <a class="code" href="classApriori__Trie.html#b2">candidate_generation_assist</a>(
00166             (*itEdge).subtrie, distance_from_generator - 1, 
00167             maybe_candidate, input_output_manager );
00168          maybe_candidate.erase((*itEdge).label);
00169          <span class="keywordflow">if</span>((*itEdge).subtrie-&gt;edgevector.empty())
00170          {
00171             <span class="keyword">delete</span> (*itEdge).subtrie;
00172             itEdge = trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.erase(itEdge);
00173          }
00174          <span class="keywordflow">else</span> itEdge++;
00175 
00176       }
00177    }
00178    <span class="keywordflow">else</span>
00179    {
00180       vector&lt;Edge&gt;::iterator itEdge2;
00181       <a class="code" href="classTrie.html">Trie</a>* toExtend;
00182       <span class="keywordflow">while</span>( itEdge != trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.end() )
00183       {
00184          maybe_candidate.insert((*itEdge).label);
00185          toExtend = (*itEdge).subtrie;
00186          input_output_manager.<a class="code" href="classInput__Output__Manager.html#a5">write_out_basket_and_counter</a>( maybe_candidate, toExtend-&gt;<a class="code" href="classTrie.html#r0">counter</a> );
00187          <span class="keywordflow">for</span>( itEdge2 = itEdge + 1; 
00188               itEdge2 != trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.end(); itEdge2++ )
00189          {
00190             maybe_candidate.insert( (*itEdge2).label );
00191             <span class="keywordflow">if</span>( <a class="code" href="classApriori__Trie.html#b0">is_all_subset_frequent</a>( maybe_candidate) )
00192                toExtend-&gt;<a class="code" href="classTrie.html#d0">add_empty_state</a>( (*itEdge2).label );
00193             maybe_candidate.erase( (*itEdge2).label );
00194          }
00195          (vector&lt;Edge&gt;(toExtend-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>)).swap(toExtend-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>);  
00196           maybe_candidate.erase((*itEdge).label);
00197          <span class="keywordflow">if</span>( toExtend-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.empty())
00198          {
00199             <span class="keyword">delete</span> (*itEdge).subtrie;
00200             itEdge = trie-&gt;<a class="code" href="classTrie.html#r1">edgevector</a>.erase(itEdge);
00201          }    
00202          <span class="keywordflow">else</span> itEdge++;
00203   <span class="comment">// we know that state toExtend will not have any more children!</span>
00204 
00205       }
00206 
00207    }
00208 }
00209 
<a name="l00216"></a><a class="code" href="classApriori__Trie.html#b3">00216</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#b3">Apriori_Trie::find_candidate_two</a>( <span class="keyword">const</span> vector&lt;itemtype&gt;&amp; basket, 
00217                                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> counter )
00218 {
00219    <span class="keywordflow">if</span>( basket.size() &gt; 1)
00220    {
00221       vector&lt;itemtype&gt;::const_iterator it1_basket,
00222                                        it2_basket;
00223 
00224       <span class="keywordflow">for</span>( it1_basket = basket.begin(); it1_basket != basket.end()-1; 
00225            it1_basket++)
00226          <span class="keywordflow">for</span>( it2_basket = it1_basket+1; it2_basket != basket.end(); 
00227               it2_basket++)
00228             <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[*it1_basket][*it2_basket-*it1_basket-1] 
00229                += counter;
00230    }
00231 }
00232 
<a name="l00236"></a><a class="code" href="classApriori__Trie.html#b4">00236</a> <span class="keywordtype">void</span> <a class="code" href="classApriori__Trie.html#b4">Apriori_Trie::delete_infrequent_two</a>( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> min_occurrence )
00237 {
00238    vector&lt;Edge&gt;::size_type stateIndex_1,
00239                             stateIndex_2;
00240    <span class="keywordflow">for</span>( stateIndex_1 = 0; stateIndex_1 &lt; <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size()-1; 
00241         stateIndex_1++ )
00242    {
00243       <span class="keywordflow">for</span>( stateIndex_2 = 0; 
00244            stateIndex_2 &lt; <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.size() - 1 - stateIndex_1; 
00245            stateIndex_2++ )
00246       {
00247         <span class="keywordflow">if</span>( <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex_1][stateIndex_2] &gt;= min_occurrence )
00248         {
00249            <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>[stateIndex_1].subtrie-&gt;add_empty_state( 
00250               stateIndex_1 + stateIndex_2 + 1,
00251               <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex_1][stateIndex_2] );
00252            <a class="code" href="classApriori__Trie.html#p2">nr_of_freq_itemsets</a>[2]++;
00253         }
00254       }
00255       <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex_1].clear();
00257       vector&lt;unsigned long&gt;().swap(<a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>[stateIndex_1]);  
00258    }
00259    <a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>.clear();
00261    vector&lt; vector&lt;unsigned long&gt; &gt;().swap(<a class="code" href="classApriori__Trie.html#p1">temp_counter_array</a>);
00262    vector&lt;Edge&gt;::iterator it= <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.begin();
00263    <span class="keywordflow">while</span>( it!=<a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.end() )
00264       <span class="keywordflow">if</span>((*it).subtrie-&gt;edgevector.empty())
00265       {
00266          <span class="keyword">delete</span> (*it).subtrie;
00267          it = <a class="code" href="classApriori__Trie.html#p0">main_trie</a>.<a class="code" href="classTrie.html#r1">edgevector</a>.erase(it);
00268       }
00269       <span class="keywordflow">else</span> it++;
00270 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Sep 3 17:23:51 2004 for APRIORI algorithm by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
